function gtm_ProductImpressions(n,t,i,r,u,f,e){if(dataLayer===undefined){console.log("dataLayer chưa khai báo");return}var o=[{name:n,id:t,price:i,brand:r,category:u,list:f,position:e}],s={ecommerce:{impressions:o},event:"productImpressions"};dataLayer.push(s)}function addListProductIntoImpressionV2(n,t,i,r=false){var e,f,h;if(n!==undefined&&n.length>0){(i===undefined||i<=0)&&(i=1);(t===undefined||t==null||t=="")&&(t="List product");var s=[],u={},o=0;for(e=0;e<n.length;e++)o++,f=n[e],h=f.parentNode.getAttribute("data-pos"),r&&(h=f.getAttribute("data-pos")),u.item_id=f.dataset.id,u.item_name=f.dataset.name,u.affiliation="Online Store",u.coupon="SUMMER_FUN",u.item_brand=f.dataset.brand,u.item_category=f.dataset.cate,u.item_category2="",u.item_category3="",u.item_status="Hàng mới",u.item_web_status=f.dataset.productstatus,u.premium_product=f.dataset.premium,u.item_promotion_type=f.dataset.promotiontype,u.index=f.parentNode.dataset.pos,u.item_list_id="related_products",u.item_list_name=t,u.item_variant=f.dataset.color,u.price=f.dataset.price,gbl_siteId!==undefined&&(gbl_siteId==1?u.dimension88=f.dataset.isRecommended===undefined||f.dataset.isRecommended===!1?"No":"Yes":gbl_siteId==2&&(u.dimension79=f.dataset.isRecommended===undefined||f.dataset.isRecommended===!1?"No":"Yes")),s.push(u),u={},(e+1==n.length&&o<i||o==i)&&(typeof gtm_ListProductImpressionsV2=="function"&&gtm_ListProductImpressionsV2(s),o=0,s=[])}}function gtm_ListProductImpressionsV2(n){if(dataLayer===undefined){console.log("dataLayer chưa khai báo");return}if(n!==undefined&&n!=null&&n.length>0){var t={ecommerce:{items:n},event:"view_item_list"};dataLayer.push(t)}}function gtm_ProductClick(n,t,i,r,u,f,e,o=false,s="",h=""){var c,l;if(typeof _paq!="undefined"){let n=GetVisitorId(),r=customerId!==""?customerId:n,u={product_id:t===undefined?"":t.toString(),product_price:i===undefined?"":i.toString(),page_url:h,box_tittle:window.location.pathname,user_id:r,session_id:n};_paq.push(["trackEvent","product_click","list product",JSON.stringify(u),0])}if(dataLayer===undefined){console.log("dataLayer chưa khai báo");return}c=[{name:n,id:t===undefined?"":t.toString(),price:i===undefined?"":i.toString(),brand:r,category:u,list:f,position:e===undefined?"":e.toString()}];gbl_siteId!==undefined&&(gbl_siteId==1?(c[0].dimension88=o===undefined||o===!1?"No":"Yes",c[0].dimension91=s===undefined||s!=="CleanStock"?"No":"Yes"):gbl_siteId==2&&(c[0].dimension79=o===undefined||o===!1?"No":"Yes",c[0].dimension82=s===undefined||s!=="CleanStock"?"No":"Yes"));l={ecommerce:{items:{products:c,actionField:{list:f}}},event:"select_item"};dataLayer.push(l)}function gtm_ProductDetailView(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){if(dataLayer===undefined){console.log("dataLayer chưa khai báo");return}var d=[{name:n,id:t,price:i,brand:r,category:u,dimension33:f,dimension34:e,dimension35:o,dimension36:s,dimension37:h,dimension16:c,dimension38:l,dimension39:a,dimension40:v,dimension41:y,dimension43:p,dimension44:w,dimension45:b}],g={event:"productDetail",serviceOrder:k,ecommerce:{detail:{products:d}}};dataLayer.push(g)}function gtm_ProductAddtoCart(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){if(dataLayer===undefined){console.log("dataLayer chưa khai báo");return}var it=[{name:n,id:t,price:i,brand:r,category:u,variant:f,quantity:e,dimension33:o,dimension34:s,dimension35:h,dimension36:c,dimension37:l,dimension16:a,dimension38:v,dimension39:y,dimension40:p,dimension41:w,dimension43:b,dimension44:k,dimension45:d,dimension42:g}],rt={event:"productAddToCart",orderType:nt,serviceOrder:tt,ecommerce:{add:{products:it}}};dataLayer.push(rt)}function ga4_productClick(n){if(n.length>0){let i={item_id:n[0].dataset.id,item_name:n[0].dataset.name,affiliation:"Online Store",coupon:"SUMMER_FUN",item_brand:n[0].dataset.brand,item_category:n[0].dataset.cate,item_category2:"",item_category3:"",item_status:"Hàng mới",item_web_status:n[0].dataset.productstatus,premium_product:n[0].dataset.premium,item_promotion_type:n[0].dataset.promotiontype,index:n[0].parentNode.dataset.pos,item_list_id:"related_products",item_list_name:"product cate",item_variant:n[0].dataset.color,price:n[0].dataset.price};var t={event:"select_item",ecommerce:{items:{products:i}}};dataLayer.push(t);console.log("ga4 select_item",i)}}function GetProductScroll(){if($(".flashsale-block").length>0)var n=$(".flashsale-block").offset().top;$(window).scroll(()=>{var t=$(".flashsale-block .listproduct .slick-active .item > a").length>0?$(".flashsale-block .slick-track .slick-active>div>div.item>a"):$(".flashsale-block .listproduct .item > a");flagGetProductScrollFlashsale=ComparePosition(n,t,flagGetProductScrollFlashsale,"Home page - Flashale"+FormatString($(".flashsale-block .gvdshock h3").text()))});$(document).on("click",".listproduct .item a",function(){ga4_productClick($(this))});$(document).on("click",".listproduct button.next-arrow",function(){var n=$(".flashsale-block .slick-track .slick-active>div>div.item>a"),t="";n.length>0&&(t="Săn Sales online mỗi ngày",addListProductIntoImpressionV2(n,t,12))});$(document).on("click",".listproduct button.prev-arrow",function(){var n=$(".flashsale-block .slick-track .slick-active>div>div.item>a"),t="";n.length>0&&(t="Săn Sales online mỗi ngày",addListProductIntoImpressionV2(n,t,12))})}function ComparePosition(n,t,i,r){if(i)return!0;var u=$(this).scrollTop();return u>=n-150&&u<=n+screen.height&&t.length>0?(addListProductIntoImpressionV2(t,r,12),!0):!1}function FormatString(n){return n.trim().replace("\n","")}function GetTabByAttr(n){let t={isRecommendTab:n.data("is-recommend-tab"),campaignId:n.data("campaign"),groupId:n.data("group")};return $(".option-sg a"+(t.isRecommendTab==!0?"[data-is-recommend-tab="+t.isRecommendTab+"]":":not([data-is-recommend-tab])")+(t.campaignId!=null?"[data-campaign="+t.campaignId+"]":":not([data-campaign])")+(t.groupId!=null?"[data-group="+t.groupId+"]":":not([data-group])"))}var flagGetProductScrollFlashsale=!1;